svgifier
========

Библиотека для автоматической вставки в DOM иконок и изображений в формате SVG.
Под капотом svgifier использует асинхронный код, Fetch API с кешированием SVG узлов
и Mutation API для отслеживания изменений в DOM дереве (только если это необходимо).

Внимание! Не применяйте svgifier совместно с React, Vue и т.п. Эта библиотека
предназначена для проектов, в которых не используются концепция виртуальных
деревьев, а вместо этого применяется манипуляция с реальными узлами DOM-дерева,
либо манипулирование DOM вообще отсутствует.


Цель проекта
------------

Библиотека создавалась как компактная автономная альтернатива таких проектов так:
- [iconify.design](https://iconify.design) (для устаревшего варианта)
- [SVGInject](https://github.com/iconfu/svg-inject)


Установка и подключение
-----------------------

NPM:

```sh
npm install git+https://github.com/h41ku/svgifier.git
```

Или PNPM:

```sh
pnpm add git+https://github.com/h41ku/svgifier.git
```

Использование модуля:

```js
import svgifier from 'svgifier'
```

Как отдельный независимый ECMAScript модуль, предварительно скаченный в файл:

```js
import svgifier from '/path/to/svgifier.esm.min.js'
```

Как отдельный независимый UMD модуль, предварительно скаченный в файл:

```html
<script src="/path/to/svgifier.umd.min.js"></script>
```

Использование
-------------

Плейсхолдер в HTML:

```html
<i class="svgify icon" data-src="/path/to/icon.svg"><i>
```

Замена плейсхолдеров:

```js
svgifier.svgify()
```

Автоматическое отслеживание изменений в DOM-дереве:

```js
const observer = svgifier.observe() // возвращает объект MutationObserver
// ...
observer.disconnect() // при необходимости можно завершить отслеживание
```

Описание API
------------

### Метод `svgifier.svgify(node, options)`

Ищет в заданном поддереве элементы-плейсхолдеры, извлекает из них данные для загрузки
изображений в формате SVG, загружает их асинхронно, по возможности используя кеш, и
заменяет плейсхолдеры на SVG-изображение.

Опциональный параметр `node`, представляет собой узел дерева DOM, являющийся поддеревом,
в котором нужно найти плейсхолдеры и произвести манипуляции по их замене.

Опциональный параметр `options`, представляет собой объект с методами для выполнения
более тонкой настройки. Допустимы следующие методы:
- `getClassName()` - возвращает название CSS-класса для селектора при поиске плейсходнеров.
- `getUrl(node)` - принимает на вход узел DOM, являющийся плейсхолдером, и возвращает URL изображения.
- `getHeaders(node)` - принимает на вход узел DOM, являющийся плейсхолдером, и возвращает объект с заголовками для запроса функцией `fetch`.

Возвращает объект `Promise`, который переходит в состояние `fulfilled` по завершению
загрузки изображений и замены плейсхолдеров.

### Метод `svgifier.observe(node, options)`

Запускает механизм отслеживания изменений в DOM дереве, путем подписки на `MutationEvent`.

При возникновении `MutationEvent`, код `MutationObserver` вызывает метод `.svgify(node, options)`
передавая опциональные параметры `node` и `options`.

Возвращает объект `MutationObserver`, сохраняя его функциональность в полной мере.
